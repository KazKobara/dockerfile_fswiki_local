### Security configuration of docker httpd
### including security headers and file accesses for
### https://github.com/KazKobara/dockerfile_fswiki_local

### Security Headers

## Against Signature
ServerTokens Prod
ServerSignature Off

## Against Clickjacking
# Header set X-Frame-Options SAMEORIGIN
Header always append X-Frame-Options DENY

## Against XSS
Header always set X-Content-Type-Options nosniff

## Against XST
TraceEnable Off

## CSP
## NOTE: If different CSPs are set multiple times, only the most strict
##   policy seems to be set on httpd 2.4.52 of alpine and ubuntu.
## TODO: Update scripts so that 'unsafe-inline' can be replaced with
##   CSP Hash or CSP Nonce.
# Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline';"
Header always set Content-Security-Policy "default-src 'self';"

### File Access
<FilesMatch "\..*">
    deny from all
</FilesMatch>

### Directory Specific Configuration
### for File Access and Security Headers
<Directory /usr/local/apache2/htdocs/>
    <FilesMatch "(wiki.cgi|favicon.ico)">
        allow from all
    </FilesMatch>
</Directory>

<DirectoryMatch "^/usr/local/apache2/htdocs/(?!theme/).*/">
    # Reset parent settings except 'theme'
    <FilesMatch "\..*">
        deny from all
    </FilesMatch>
</DirectoryMatch>

<Directory /usr/local/apache2/htdocs/theme/>
    <FilesMatch "\..*">
        deny from all
    </FilesMatch>
    # Reset parent settings, then
    <FilesMatch "\.(css|jpe?g|gif|png)$">
        allow from all
    </FilesMatch>
</Directory>

<Directory /usr/local/apache2/htdocs/theme/resources/jsdifflib>
    ## NOTE: If different CSPs are set multiple times, only the most strict
    ##   policy seems to be set on httpd 2.4.52 of alpine and ubuntu.
    ## TODO: Update scripts so that 'unsafe-inline' can be replaced with
    ##   CSP Hash or CSP Nonce.
    # Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline';"
    ## Inherent parent settings, and
    <FilesMatch "\.(js)$">
        allow from all
    </FilesMatch>
</Directory>
