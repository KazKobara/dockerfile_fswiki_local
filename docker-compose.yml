version: '3.7'

# -------------- Edit .env and Here ---------------
x-var: &REQUIRE_IP
    # IP or network addresses to be accessed from:
    # docker-compose assigns 172.x or 192.168 to its bridge network using round robin.
    "172 192.168"
# ---------------------------------

services:
    fswiki_local:
        container_name: fswiki_${FSWIKI_PLATFORM}_local_dc
        image: fswiki_${FSWIKI_PLATFORM}_local_dc:${FSWIKI_VERSION}
        build:
            context: .
            dockerfile: "./${FSWIKI_PLATFORM}/Dockerfile"
            args:
                require_ip: *REQUIRE_IP
                tag_version: ${TAG_VERSION}
                fswiki_version: ${FSWIKI_VERSION}
                fswiki_tmp_dir: ${FSWIKI_TMP_DIR}
        volumes:
            # Adding "" does not work.
            - ${FSWIKI_DATA_PREFIX}/${USER}/${FSWIKI_DATA_DIR}/data:/usr/local/apache2/htdocs/data
            - ${FSWIKI_DATA_PREFIX}/${USER}/${FSWIKI_DATA_DIR}/attach:/usr/local/apache2/htdocs/attach
            - ${FSWIKI_DATA_PREFIX}/${USER}/${FSWIKI_DATA_DIR}/config:/usr/local/apache2/htdocs/config
            - ${FSWIKI_DATA_PREFIX}/${USER}/${FSWIKI_DATA_DIR}/log:/usr/local/apache2/htdocs/log
            #- ${FSWIKI_DATA_ROOT}/data:/usr/local/apache2/htdocs/data
            #- ${FSWIKI_DATA_ROOT}/attach:/usr/local/apache2/htdocs/attach
            #- ${FSWIKI_DATA_ROOT}/config:/usr/local/apache2/htdocs/config
            #- ${FSWIKI_DATA_ROOT}/log:/usr/local/apache2/htdocs/log
        ports:
            - "${FSWIKI_PORT}:80"
        restart: always
